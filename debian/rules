#!/usr/bin/make -f
# -*- makefile -*-

PACKAGE=centreon-engine
PACKAGEDIR=debian/$(PACKAGE)

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

# to run with quilt use this instead:
# dh  --with quilt $@

%:
	dh $@ --sourcedirectory=build
override_dh_auto_configure:
	dh_auto_configure -O--sourcedirectory=build \
	    -- \
	    -DWITH_PREFIX_CONF=$(DESTDIR)/etc/centreon-engine  \
	    -DWITH_USER=centreon-engine  \
	    -DWITH_GROUP=centreon-engine  \
	    -DWITH_LOGROTATE_SCRIPT=1 \
	    -DWITH_CREATE_FILES=0 \
	    -DWITH_VAR_DIR=$(DESTDIR)/var/log/centreon-engine  \
	    -DWITH_RW_DIR=$(DESTDIR)/var/lib/centreon-engine/rw  \
	    -DWITH_STARTUP_DIR=$(DESTDIR)/etc/init.d

override_dh_auto_install:
	dh_auto_install -O--sourcedirectory=build
	# We don't need the include files.
	cd $(PACKAGEDIR) && rm -fr \
	  usr/include \
	  usr/lib/centreon-engine/pkgconfig
	if test -f $(PACKAGEDIR)/etc/init.d/centengine.conf; then \
	  mv $(PACKAGEDIR)/etc/init.d $(PACKAGEDIR)/etc/init; \
	fi

override_dh_clean:
	dh_clean \
	  conf/centengine.cfg \
	  inc/com/centreon/engine/version.hh \
	  inc/compatibility/locations.h \
	  scripts/centengine.pc \
	  scripts/upstart.conf \
	  test/paths.hh \
	  test/paths.hh.in \
	  test/running/etc/host_with_no_check_cmd.cfg \
	  test/running/etc/logs_for_modules.cfg \
	  test/running/etc/modules_symbols.cfg \
	  test/running/etc/service_with_no_check_cmd.cfg \
	  conf/resource.cfg \
	  inc/compatibility/common.h \
	  scripts/centengine.sh \
	  scripts/logrotate.conf

	rm -rf \
	  conf/objects/*.cfg
